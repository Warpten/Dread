## dreadful

An IDA Pro plugin to help in disassembly of Metroid Dread.

* `src/dreadful-ast-matcher`: Encapsulates parts of the code of the plugin that call into Clang.
* `src/dreadful-plugin-ida-base`: Encapsules parts of the code of the plugin that call into IDA's SDK.
* `src/dreadful-plugin-dump`: A simple plugin, unrelated to Metroid Dread, that dumps pseudocode consumable by Clang in IDA's output window.
* `src/dreadful-plugin`: The actual implementation of the plugin.

### Supported versions

|  | MD5 | State |
|---|---|---|
| V1.0 | F5D9AA2AF3ABEF3070791057060EE93C | WIP |

### Implementation details

:warning: We recommend running this plugin on a **blank** IDB.

1. Search for calls to CRC64 (the offset of which is the only hardcoded value, and specified per-binary version)
2. For all occurences, search for (what we hereafter refer to) reflobjects constructors:  
   They should look something like this:
   ![](https://i.imgur.com/EcSjlm4.png)  
   Note that this is the output of code generated by the plugin, and may differ from the default pseudocode generated by Hex-Rays.  
   From there, we extract all constant property values; that is, integers and function pointers.
3. We then look for callers to the function analyzed in the previous step; there should only be one, and will be denoted as the reflobject accessor.
   They should look something like this:  
   ![](https://i.imgur.com/06TdcfU.png)
4. From there, we can deduce the actual name of the type for which the reflobject is constructed, its base type, publicly exposed functions, and member variables.
